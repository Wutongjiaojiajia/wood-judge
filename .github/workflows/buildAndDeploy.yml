# name: buildAndDeploy
# on:
#   push:
#     branches: [ master ]

# jobs:
#   build-and-deploy:
#     runs-on: ubuntu-latest
#     steps:
#     - name: checkout
#       uses: actions/checkout@master # 将代码拷贝到虚拟机中
#     - name: buildAndDeploy
#       uses: JamesIves/github-pages-deploy-action@master
#       env:
#         ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }} # 使用刚新建的secret
#         BRANCH: gh-pages # 存放产物的分支名称
#         FOLDER: dist # 存放build后产物的目录
#         BUILD_SCRIPT: npm install && npm run build # 执行的命令

on:
  push:
    branches: # 当推送分支时
      - master
env:
  ACCESS_TOKEN: ${{secrets.ACCESS_TOKEN}}  #新建的TOKEN
  aliyun_docker_username: ${{secrets.aliyun_docker_username}}
  aliyun_docker_password: ${{secrets.aliyun_docker_password}}
jobs:
  #构建安装依赖，构建文件
  build-production: 
    runs-on: ubuntu-latest
    steps:
      # 将代码拷贝到虚拟机
      - name: checkout 
        uses: actions/checkout@v2
      # 安装使用 node:12
      - name: setup Node.js 12
        uses: actions/setup-node@v1
        with:
          node-version: '12'
      # 安装依赖
      - name: Install Dependencies And Build 
        run: | 
          npm install
          npm run build
        env:
          CI: true
      - name: Build Docker image
        run: |
          docker login -u 唔通叫家家 --password-stdin Aa19961023. registry.cn-shenzhen.aliyuncs.com 
          docker build -t wood-judge:latest
          docker tag wood-judge registry.cn-shenzhen.aliyuncs.com/wutongjiaojiajia/wood-vue-deploy:latest
          docker push registry.cn-shenzhen.aliyuncs.com/wutongjiaojiajia/wood-vue-deploy:latest